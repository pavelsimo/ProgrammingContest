<html><body bgcolor="#000000" text="#ffffff"><table><tr><td colspan="2"><h3>Problem Statement</h3></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><p>Alice and Bob decide to play a game with a deck of cards.  Each card has a single positive integer written on it.  Multiple cards may have the same number.  Cards with the same number are indistinguishable.  Alice and Bob begin by splitting the deck into two piles.  They each take one pile.  Then each of them writes down the sequence of numbers on the cards in his/her pile, in order from bottom to top.</p>

<p>Then comes the first phase of the game.
In this phase Alice and Bob build a third pile of cards, designated the "community" pile.
Initially, the community pile is empty.
The phase consists of multiple turns.
In each turn, either Alice or Bob takes the top card from his/her pile and places it on top of the community pile.
This continues until all the cards are in the community pile.
(Note that Alice and Bob are not required to alternate. They may take the turns in any order they like.)</p>

<p>Afterwards there is the second phase of the game.
In this phase Alice and Bob take the cards from the community pile to their personal piles.
Again, this happens in turns.
In each turn, either Alice or Bob takes the top card from the community pile and places it on top of his/her personal pile.
This continues until there are no more cards in the community pile.
(Again, Alice and Bob are not required to alternate. They may take the turns in any order they like.
They are each allowed to take any cards to their pile, not just those they had at the beginning.
They are also each allowed to take any number of cards, regardless of how many they had at the beginning.)
Finally, they again write down the sequence of numbers on the cards in each pile, from bottom to top.</p>

<p>Later, Alice and Bob decide to double-check what they wrote down.  Given the starting and ending lists of cards, they wonder how many ways the game could have progressed.  You will be given 4 vector &lt;int&gt;s: <b>AliceStart</b>, <b>BobStart</b>, <b>AliceEnd</b>, and <b>BobEnd</b>.  <b>AliceStart</b> and <b>BobStart</b> are the card stacks belonging to Alice and Bob at the start, and <b>AliceEnd</b> and <b>BobEnd</b> are the card stacks belonging to Alice and Bob at the end.  Return the number of different possible ways the game could have progressed, modulo 1,000,000,007 (10^9+7).</p></td></tr><tr><td colspan="2"><h3>Definition</h3></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td>Class:</td><td>AliceBobShuffle</td></tr><tr><td>Method:</td><td>countWays</td></tr><tr><td>Parameters:</td><td>vector &lt;int&gt;, vector &lt;int&gt;, vector &lt;int&gt;, vector &lt;int&gt;</td></tr><tr><td>Returns:</td><td>int</td></tr><tr><td>Method signature:</td><td>int countWays(vector &lt;int&gt; AliceStart, vector &lt;int&gt; BobStart, vector &lt;int&gt; AliceEnd, vector &lt;int&gt; BobEnd)</td></tr><tr><td colspan="2">(be sure your method is public)</td></tr></table></td></tr><tr><td>&#160;&#160;&#160;&#160;</td></tr><tr><td></td></tr><tr><td colspan="2"><h3>Notes</h3></td></tr><tr><td align="center" valign="top">-</td><td>Each card movement can be described by the source pile, the destination pile, and the number on the card.</td></tr><tr><td align="center" valign="top">-</td><td>Two games are considered different if their sequences of card movements differ.</td></tr><tr><td colspan="2"><h3>Constraints</h3></td></tr><tr><td align="center" valign="top">-</td><td><b>AliceStart</b>, <b>BobStart</b>, <b>AliceEnd</b>, and <b>BobEnd</b> will each contain between 1 and 50 elements, inclusive.<br></br></td></tr><tr><td align="center" valign="top">-</td><td>Each element of <b>AliceStart</b>, <b>BobStart</b>, <b>AliceEnd</b>, and <b>BobEnd</b> will be between 1 and 100, inclusive.</td></tr><tr><td colspan="2"><h3>Examples</h3></td></tr><tr><td align="center" nowrap="true">0)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>{1, 3}</pre></td></tr><tr><td><pre>{2, 4}</pre></td></tr><tr><td><pre>{2, 3}</pre></td></tr><tr><td><pre>{1, 4}</pre></td></tr></table></td></tr><tr><td><pre>Returns: 4</pre></td></tr><tr><td><table><tr><td colspan="2">There are 4 possible orders for the community pile at the end of the first phase: {4, 3, 2, 1}, {3, 4, 2, 1}, {4, 3, 1, 2}, {3, 4, 1, 2}.  (All of these are listed from bottom to top.)  Each of these uniquely determines one possible game.</td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">1)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>{1, 2, 1}</pre></td></tr><tr><td><pre>{1, 2}</pre></td></tr><tr><td><pre>{1, 2, 1}</pre></td></tr><tr><td><pre>{2, 1}</pre></td></tr></table></td></tr><tr><td><pre>Returns: 4</pre></td></tr><tr><td><table><tr><td colspan="2">The only possibility for the order of the community pile at the end of the first phase is {1, 2, 1, 2, 1}.  Still, there are 4 ways this game could have been played.  (For instance, the bottommost 1 must have come from Alice's deck, but the 2 above it could have been placed by either player.)</td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">2)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>{1}</pre></td></tr><tr><td><pre>{2}</pre></td></tr><tr><td><pre>{3}</pre></td></tr><tr><td><pre>{4}</pre></td></tr></table></td></tr><tr><td><pre>Returns: 0</pre></td></tr><tr><td><table><tr><td colspan="2">This is impossible.</td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">3)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>{1, 2}</pre></td></tr><tr><td><pre>{3}</pre></td></tr><tr><td><pre>{3}</pre></td></tr><tr><td><pre>{2, 1}</pre></td></tr></table></td></tr><tr><td><pre>Returns: 0</pre></td></tr><tr><td><table><tr><td colspan="2">Also impossible.</td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">4)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>{3, 3, 2, 4, 1, 3, 1, 2, 1, 1, 5, 5, 1, 2, 3, 1, 2, 1, 2, 1, 1, 1, 2}</pre></td></tr><tr><td><pre>{4, 1, 4, 3, 4, 4, 4, 3, 2, 1, 6, 2, 2, 3, 2, 2, 1, 3, 2, 3}</pre></td></tr><tr><td><pre>{4, 1, 4, 3, 4, 4, 4, 1, 3, 1, 2, 2, 2, 3, 2, 1, 2, 1, 2, 2, 2}</pre></td></tr><tr><td><pre>{3, 3, 2, 3, 4, 2, 1, 2, 1, 1, 5, 6, 5, 1, 3, 1, 2, 3, 1, 1, 1, 3}</pre></td></tr></table></td></tr><tr><td><pre>Returns: 314159265</pre></td></tr><tr><td><table><tr><td colspan="2"></td></tr></table></td></tr></table></td></tr></table><p>This problem statement is the exclusive and proprietary property of TopCoder, Inc.  Any unauthorized use or reproduction of this information without the prior written consent of TopCoder, Inc. is strictly prohibited.  (c)2003, TopCoder, Inc.  All rights reserved.  </p></body></html>
